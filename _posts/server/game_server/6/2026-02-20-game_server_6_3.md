---
title:  "[κ²μ„ μ„λ²„] 6.3 κ²μ„ ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ κ°„ ν†µμ‹ "
excerpt: "6.3"

categories:
  - GameServer
tags:
  - [GameServer]

toc: true
toc_sticky: true
 
date: 2026-02-20
last_modified_at: 2026-02-20
---
# π“¦ 6. κ²μ„ λ„¤νΈμ›ν¬ μ—”μ§„ ν”„λΌμ°λ“λ„·
## π‘‰π» 3. κ²μ„ ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ κ°„ ν†µμ‹ 

### π” μ—°κ²° κ³Όμ •

```mermaid
---
config:
  look: handDrawn
  theme: dark
  layout: dagre
---
sequenceDiagram
  Participant C as ν΄λΌμ΄μ–ΈνΈ
  Participant S as μ„λ²„
  
  Note over S: CNetServer.Create<br>CNetServer.Start
  Note over C: CNetClient.Create<br>CNetClient.Connect
  C->>S: λ„¤νΈμ›ν¬ μ—°κ²°
  Note over S: OnClientJoin μ΄λ²¤νΈ
  S-->>C: μ„±κ³µ
  Note over C: OnJoinServerComplete μ΄λ²¤νΈ<br>(μΈμλ΅ μ„±κ³µ μ—¬λ¶€ ν™•μΈ)
```

**κΈ°λ³Έ νλ¦„:**
1. `CNetServer.Create()`λ΅ CNetServer μΈμ¤ν„΄μ¤ μƒμ„±
2. `CNetServer.Start()`λ΅ μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈ μ ‘μ†ν•  μ μλ„λ΅ ν•¨
    - ν•„μ λ§¤κ°λ³€μ: ν”„λ΅ν† μ½ λ²„μ „, λ¦¬μ¤λ‹ ν¬νΈ λ²νΈ
3. `CNetClient.Create()`λ΅ ν΄λΌμ΄μ–ΈνΈ μΈμ¤ν„΄μ¤ μƒμ„±
4. `CNetClient.Connect()`λ΅ μ„λ²„μ— μ ‘μ†
    - μ…λ ¥ κ°’: μ„λ²„ μ£Όμ†, ν¬νΈ κ°’, ν”„λ΅ν† μ½ λ²„μ „ κ°’

---

### π μ—°κ²° ν•΄μ  κ³Όμ •

```mermaid
---
config:
  look: handDrawn
  theme: dark
  layout: dagre
---
sequenceDiagram
  Participant C as ν΄λΌμ΄μ–ΈνΈ
  Participant S as μ„λ²„
  
  Note over C: CNetClient.Disconnect
  C-xS: μ—°κ²° ν•΄μ 
  Note over C: OnLeaveServer μ΄λ²¤νΈ
  Note over S: OnClientLeave μ΄λ²¤νΈ
```

**μ •μƒμ μΌλ΅ λ‚κ°€λ” κ²½μ°:**
1. ν΄λΌμ΄μ–ΈνΈμ—μ„ `Disconnect()` ν•¨μλ΅ μ—°κ²° ν•΄μ 
2. μ„λ²„μ—μ„ `OnClientLeave()` μ΄λ²¤νΈ νΈμ¶

**μ—°κ²°μ΄ λμ–΄μ§„ κ²½μ°:**
1. μ„λ²„/ν΄λΌμ΄μ–ΈνΈ μ—°κ²° λκΉ€
2. ν΄λΌμ΄μ–ΈνΈμ—μ„ `OnLeaveServer()` μ΄λ²¤νΈ νΈμ¶
3. μ„λ²„μ—μ„ `OnClientLeave()` μ΄λ²¤νΈ νΈμ¶

---

### π”‘ HostID

**μ‹λ³„μ:**
- μ„λ²„/ν΄λΌμ΄μ–ΈνΈλ” μ •μ νƒ€μ… μ‹λ³„μμΈ **HostID**λ΅ κµ¬λ¶„
- μ„λ²„λ” ν•­μƒ κ³ μ • κ°’μΈ `HostID_Server`λ¥Ό κ°€μ§
- ν΄λΌμ΄μ–ΈνΈλ” μ„λ΅ λ‹¤λ¥Έ HostIDλ¥Ό κ°€μ§

---

### π’» μ„λ²„ μ½”λ“ μμ‹

```cpp
CNetServer* s = CNetServer::Create(); // 1
param.m_tcpPorts.Add(44444); // 2
param.m_udpPorts.Add(44444);
// 3
param.m_protocolVersion = Guid(
	{ 0x5dca93f4,
		0x8133,
		0x44a0,
		{0xb5, 0x7b, 0x75, 0x7d, 0x9c, 0x78, 0xd5, 0x2e}
	}
);
s->Start(param);

// 4
s->OnClientJoin = [](CNetClientInfo* info) {
	// infoμ—λ” μƒ ν΄λΌμ΄μ–ΈνΈ μ •λ³΄κ°€ μλ‹¤.
	...
};

// 5
s->OnClientLeave = [](CNetClientInfo* client,
	ErrorInfo* reason,
	const ByteArray& comment) {
	// μ—¬κΈ°μ— μ΄λ²¤νΈ μ²λ¦¬ μ½”λ“ μ¶”κ°€
};
```

**μ„¤λ…:**
1. μ„λ²„ μƒμ„± κ³Όμ •
2. TCP λ¦¬μ¨ ν¬νΈ κ°’ μ„¤μ •
    - μƒμ—…μ© κ²μ„μ€ ν¬νΈλ¥Ό 2κ° μ‚¬μ©ν•κΈ°λ„ ν•κΈ°μ—, tcpPortsλ” λ°°μ—΄ νƒ€μ…
3. μ„λ²„/ν΄λΌμ΄μ–ΈνΈ ν”„λ΅ν† μ½ λ²„μ „ κ°’μ„ μ„λ΅ κ°™κ² λ§μ¶°μ•Ό ν•λ‹¤
4. μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈ μ—°κ²°μ„ μ„±κ³µμ μΌλ΅ λ°›μΌλ©΄ `OnClientJoin` μ΄λ²¤νΈκ°€ νΈμ¶λλ‹¤
    - infoλ¥Ό ν†µν•΄ ν΄λΌμ΄μ–ΈνΈμ HostIDμ™€ λ‹¤μ–‘ν• μ •λ³΄λ¥Ό μ–»μ„ μ μλ‹¤
5. ν΄λΌμ΄μ–ΈνΈκ°€ λ‚κ°€λ” κ²ƒμ΄ κ°μ§€λλ©΄ `OnClientLeave()` ν•¨μκ°€ νΈμ¶λλ‹¤
    - λ§¤κ°λ³€μ CNetClientInfoλ¥Ό ν†µν•΄ λ¬΄μ¨ ν΄λΌμ΄μ–ΈνΈκ°€ μ™ λ‚κ°”λ”μ§€ μ• μ μλ‹¤

---

### π–¥οΈ ν΄λΌμ΄μ–ΈνΈ μ½”λ“ μμ‹

```cpp
CNetClient* c = CNetClient::Create();
param.m_serverAddr = _PNT("my.game.com"); // 1
param.m_serverPort = 44444; // 1
param.m_protocolVersion = Guid(...);
c->Connect(params);

// 2
c->OnJoinServerComplete = [](ErrorInfo* result) {
	if(result->m_errorType == ErrorType_Ok) {
		... // μ„±κ³µ μ²λ¦¬
	}
	else {
		print(result->ToString());
		... // μ‹¤ν¨ μ²λ¦¬
	}
};

c->FrameMove(); // 3

// 4
c->OnLeaveServer = [](ErrorInfo* reason) {
	// reasonμ—λ” λκΈ΄ μ΄μ κ°€ λ‹΄κ²¨ μλ‹¤.
	...
};
```

**μ„¤λ…:**
1. μ„λ²„μ λμ  κ°’μ„ λ„£λ”λ‹¤
2. μ„λ²„ μ ‘μ†μ΄ μ™„λ£λμ—μ„ λ• νΈμ¶ν•  μ΄λ²¤νΈ ν•¨μλ¥Ό μ‘μ„±ν•λ‹¤
    - λ§¤κ°λ³€μλ” ErrorInfo μΈμ¤ν„΄μ¤λ΅, μ„±κ³µ μ λ¬΄/μ‹¤ν¨ μ΄μ λ¥Ό μ•λ ¤μ¤€λ‹¤
3. `FrameMove()` ν•¨μλ¥Ό νΈμ¶ν•λ©΄, λ§μ§€λ§‰ FrameMove()λ¶€ν„° μ§€κΈκΉμ§€ λ„μ λ μ΄λ²¤νΈλ‚ μμ‹ λ λ©”μ‹μ§€μ— λ€ν• μ΄λ²¤νΈ μ½λ°±μ΄ μΌμ–΄λ‚λ‹¤
4. μ„λ²„μ™€μ μ—°κ²°μ΄ λμ–΄μ§ λ• `OnLeaveServer()` ν•¨μλ¥Ό νΈμ¶ν•λ‹¤
    - reasonμ—λ” λκΈ΄ μ΄μ μ— λ€ν• μ •λ³΄κ°€ λ‹΄κ²¨ μλ‹¤

---

# π§ μ •λ¦¬

**μ „μ²΄ κ³Όμ •:**
1. NetServerλ¥Ό μƒμ„±ν•κ³  `Start()` ν•¨μ νΈμ¶
2. NetClientλ¥Ό μƒμ„±ν•κ³  `Connect()` ν•¨μ νΈμ¶
3. `NetServer.OnClientJoin()`, `OnClientLeave()`μ—μ„ ν΄λΌμ΄μ–ΈνΈ μ…μ¥/ν‡΄μ¥ μ²λ¦¬
4. `NetClient.OnJoinServerComplete()`, `OnLeaveServer()`μ—μ„ μ„λ²„ μ ‘μ† μ„±κ³µ/μ‹¤ν¨/μ¤‘λ„ μ—°κ²° ν•΄μ  μ²λ¦¬
5. `NetClient.FrameMove()`λ¥Ό μ§€μ†μ μΌλ΅ νΈμ¶

**ν•µμ‹¬ κ°λ…:**
- ν”„λ΅ν† μ½ λ²„μ „μΌλ΅ νΈν™μ„± κ²€μ¦
- HostIDλ΅ κ° ν΄λΌμ΄μ–ΈνΈ μ‹λ³„
- μ΄λ²¤νΈ κΈ°λ° λΉ„λ™κΈ° μ²λ¦¬
- FrameMove()λ΅ μ΄λ²¤νΈ ν΄λ§