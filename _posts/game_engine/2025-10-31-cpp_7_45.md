---
title:  "[C++] ν•­λ© 45: \"νΈν™λλ” λ¨λ“  νƒ€μ…\"μ„ λ°›μ•„λ“¤μ΄λ” λ°λ” λ©¤λ²„ ν•¨μ ν…ν”λ¦Ώμ΄ μ§λ°©!"
excerpt: "ν•­λ© 45"

categories:
  - Cpp
tags:
  - [Cpp]

toc: true
toc_sticky: true
 
date: 2025-10-31
last_modified_at: 2025-10-31
---
μ΄ κΈ€μ€ μ•„λμ μ±…μ„ μμ„Έν μ •λ¦¬ν• ν›„, μ •λ¦¬ν• κΈ€μ„ GPTμ—κ² μ”μ•½μ„ μ”μ²­ν•μ—¬ μ‘μ„±λμ—μµλ‹λ‹¤.  
μ΄ν™ν‹°λΈ C++ μ 3ν, μ¤μ½§ λ§μ΄μ–΄μ¤ μ €μ, κ³½μ©μ¬ λ²μ—­
{: .notice--warning}

# π“¦ 7. ν…ν”λ¦Ώκ³Ό μΌλ°ν™” ν”„λ΅κ·Έλλ°
## π‘‰π» ν•­λ© 45: "νΈν™λλ” λ¨λ“  νƒ€μ…"μ„ λ°›μ•„λ“¤μ΄λ” λ°λ” λ©¤λ²„ ν•¨μ ν…ν”λ¦Ώμ΄ μ§λ°©!

## β… κΈ°λ³Έ ν¬μΈν„°μ μ•”μ‹μ  λ³€ν™

ν¬μΈν„°λ” μ•”μ‹μ  λ³€ν™μ„ μ§€μ›ν•λ‹¤ (ν•μ§€λ§ μ¤λ§νΈ ν¬μΈν„°λ” λ¶κ°€)

**κΈ°λ³Έ ν¬μΈν„°κ°€ μ§€μ›ν•λ” λ³€ν™:**

- νμƒ ν΄λμ¤ ν¬μΈν„° β†’ κΈ°λ³Έ ν΄λμ¤ ν¬μΈν„°
- λΉ„μƒμ κ°μ²΄ ν¬μΈν„° β†’ μƒμ κ°μ²΄ ν¬μΈν„°
- κΈ°νƒ€ λ“±λ“±...

```cpp
class Top { ... };
class Middle: public Top { ... };
class Bottom: public Middle { ... };

int main() {
	// Middle* => Top*
	Top* pt1 = new Middle;
	// Bottom* => Top*
	Top* pt2 = new Bottom;
	// Top* => const Top*
	const Top* pct2 = pt1;
}
```

---

## β οΈ λ¬Έμ : κ°™μ€ ν΄λμ¤ κ³„ν†µμ λ³€ν™ λ¶κ°€

```cpp
template<typename T>
class SmartPtr {
public:
	explicit SmartPtr(T* realPtr);
	...
};

int main() {
	// SmartPtr<Middle> => SmartPtr<Top>
	SmartPtr<Top> pt1 = SmartPtr<Middle>(new Middle);
	// SmartPtr<Bottom> => SmartPtr<Top>
	SmartPtr<Top> pt2 = SmartPtr<Bottom>(new Bottom);
	// SmartPtr<Top> => SmartPtr<const Top>
	SmartPtr<const Top> pct2 = pt1;
}
```

**λ¬Έμ :**

- κ°™μ€ ν…ν”λ¦ΏμΌλ΅λ¶€ν„° λ§λ“¤μ–΄μ§„ λ‹¤λ¥Έ μΈμ¤ν„΄μ¤λ“¤ μ‚¬μ΄μ—λ” **μ–΄λ–¤ κ΄€κ³„κ°€ μ—†λ‹¤**
- `SmartPtr<Middle>`κ³Ό `SmartPtr<Top>`μ€ **μ™„μ „ν λ³„κ°μ ν΄λμ¤**

**ν„μ‹¤μ  ν•κ³„:**

- `SmartPtr` ν΄λμ¤λ“¤ μ‚¬μ΄μ— λ³€ν™μ„ ν•κ³  μ‹¶λ‹¤λ©΄, **μ§μ ‘ λ³€ν™μ΄ λλ„λ΅ λ§λ“¤μ–΄μ•Ό ν•λ‹¤**
- μ¤λ§νΈ ν¬μΈν„°μ μƒμ„±μ ν•¨μλ¥Ό μ§μ ‘ ν•λ•€ν•λ•€ λ§λ“λ” κ²ƒμ€ **λ¶κ°€λ¥**ν•λ‹¤
    - `Top` ν΄λμ¤ κ³„ν†µμ΄ λ” λμ–΄λ‚λ‹¤λ©΄, λ‹¤λ¥Έ μ¤λ§νΈ ν¬μΈν„° νƒ€μ…μΌλ΅λ¶€ν„° `SmartPtr<Top>` κ°μ²΄λ¥Ό λ§λ“¤ λ°©λ²•λ„ λ§λ“¤μ–΄μ•Ό ν•κΈ° λ•λ¬Έ

---

## β… ν•΄κ²°: λ©¤λ²„ ν•¨μ ν…ν”λ¦Ώ

**λ©¤λ²„ ν•¨μ ν…ν”λ¦Ώ:**

> μ–΄λ–¤ ν΄λμ¤μ λ©¤λ²„ ν•¨μλ¥Ό μ°μ–΄λ‚΄λ” ν…ν”λ¦Ώ

```cpp
template<typename T>
class SmartPtr {
public:
	// "μΌλ°ν™”λ λ³µμ‚¬ μƒμ„±μ"λ¥Ό λ§λ“¤κΈ° μ„ν•΄
	// λ§λ ¨ν• λ©¤λ²„ ν…ν”λ¦Ώ
	template<typename U>
	SmartPtr(const SmartPtr<U>& other);
	...
};
```

**μΌλ°ν™” λ³µμ‚¬ μƒμ„±μ:**

> κ°™μ€ ν…ν”λ¦Ώμ„ μ¨μ„ μΈμ¤ν„΄μ¤ν™”λμ§€λ§,  
> νƒ€μ…μ΄ λ‹¤λ¥Έ νƒ€μ…μ κ°μ²΄λ΅λ¶€ν„° μ›ν•λ” κ°μ²΄λ¥Ό λ§λ“¤μ–΄μ£Όλ” μƒμ„±μ

**ν¨κ³Ό:**

- μ„ μ½”λ“μ κ²½μ°, λ¨λ“  `T` νƒ€μ… λ° λ¨λ“  `U` νƒ€μ…μ— λ€ν•΄μ„
- `SmartPtr<U>` κ°μ²΄λ΅λ¶€ν„° `SmartPtr<T>` κ°μ²΄λ¥Ό μƒμ„±ν•  μ μλ‹¤

---

### π“ explicitλ¥Ό μ‚¬μ©ν•μ§€ μ•μ€ μ΄μ 

**μ§λ¬Έ:** μ™ μΌλ°ν™” λ³µμ‚¬ μƒμ„±μλ¥Ό `explicit`λ΅ μ„ μ–Έν•μ§€ μ•μ•λ”κ°€?

**λ‹µλ³€:**

- κΈ°λ³Έ μ κ³µ ν¬μΈν„°λ” ν¬μΈν„° νƒ€μ… μ‚¬μ΄μ νƒ€μ… λ³€ν™μ΄ **μ•”μ‹μ μΌλ΅** μ΄λ£¨μ–΄μ§€λ©°, μΊμ¤ν…μ΄ ν•„μ”ν•μ§€ μ•λ‹¤
- νμƒ ν΄λμ¤ ν¬μΈν„° β†’ κΈ°λ³Έ ν΄λμ¤ ν¬μΈν„°λ΅μ λ³€ν™μ΄ μλ‹¤
- μ: `Top* pt = new Middle;`

---

### π¨ ν„μ¬ μ½”λ“μ λ¬Έμ μ 

**μ›μΉ μ•λ” λ³€ν™μ΄ κ°€λ¥ν•¨:**

- β `SmartPtr<Top>` β†’ `SmartPtr<Bottom>` κ°€λ¥
- β `SmartPtr<double>` β†’ `SmartPtr<int>` κ°€λ¥

**μμ‹ μ½”λ“:**

```cpp
template<typename T>
class SmartPtr {
public:
    SmartPtr(T* ptr): heldPtr(ptr) {}

    // μΌλ°ν™” λ³µμ‚¬ μƒμ„±μ
    // μ•„λ¬΄κ²ƒλ„ ν•μ§€ μ•λ” κ²ƒ κ°™μ•„λ³΄μ΄μ§€λ§,
    // λ‚΄λ¶€μ—μ„ μ¨κ²¨μ§„ λ™μ‘μ„ μν–‰ν•λ‹¤.
    template<typename U>
    SmartPtr(const SmartPtr<U>& other) {}

    T* get() { return heldPtr; }
private:
    T* heldPtr;
};

int main() {
    SmartPtr<Top> st(new Top);

    // β οΈ SmartPtr<Top> β†’ SmartPtr<Bottom> (λ…Όλ¦¬μ μΌλ΅ λ¶κ°€λ¥ν•μ§€λ§ μ»΄νμΌλ¨)
    SmartPtr<Bottom> p3 = st;

    // β οΈ SmartPtr<double> β†’ SmartPtr<int> (μ΄μƒν•μ§€λ§ μ»΄νμΌλ¨)
    SmartPtr<int> p4 = SmartPtr<double>(new double(3.14));
}
```

<details>
<summary>μ „μ²΄ μ½”λ“ (νΌμΉκΈ°/μ ‘κΈ°)</summary>
<pre><code class="language-cpp">
#include &lt;iostream&gt;
#include &lt;typeinfo&gt;

using namespace std;

template&lt;typename T&gt;
class SmartPtr {
public:
    SmartPtr(T* ptr): heldPtr(ptr) {}

    // μΌλ°ν™” λ³µμ‚¬ μƒμ„±μ.
    // μ•„λ¬΄κ²ƒλ„ ν•μ§€ μ•λ” κ²ƒ κ°™μ•„λ³΄μ΄μ§€λ§,
    // λ‚΄λ¶€μ—μ„ μ¨κ²¨μ§„ λ™μ‘μ„ μν–‰ν•λ‹¤.
    template&lt;typename U&gt;
    SmartPtr(const SmartPtr&lt;U&gt;&amp; other) {}

    T* get() {
        return heldPtr;
    }
private:
    T* heldPtr;
};


struct Top {};
struct Middle : Top {};
struct Bottom : Middle {};

int main() {
    SmartPtr&lt;Bottom&gt; sb(new Bottom);
    SmartPtr&lt;Middle&gt; sm(new Middle);
    SmartPtr&lt;Top&gt; st(new Top);

    cout &lt;&lt; "\n--- μ¬λ°”λ¥Έ λ³€ν™ ---\n";
    // β… SmartPtr&lt;Bottom&gt; β†’ SmartPtr&lt;Top&gt; (OK)
    SmartPtr&lt;Top&gt; p1 = sb;
    cout &lt;&lt; "p1μ νƒ€μ…: " &lt;&lt; typeid(p1.get()).name() &lt;&lt; endl;

    cout &lt;&lt; "------" &lt;&lt; endl;

    // β… SmartPtr&lt;double&gt; β†’ SmartPtr&lt;double&gt; (OK)
    SmartPtr&lt;double&gt; p2 = SmartPtr&lt;double&gt;(new double(3.14));
    cout &lt;&lt; "p2μ νƒ€μ…: " &lt;&lt; typeid(p2.get()).name() &lt;&lt; endl;
    cout &lt;&lt; "p2μ ν¬μΈν„° κ°’: " &lt;&lt; *(p2.get()) &lt;&lt; endl;

    std::cout &lt;&lt; "\n--- μλ»λ λ³€ν™ ---\n";
    // β οΈ SmartPtr&lt;Top&gt; β†’ SmartPtr&lt;Bottom&gt; (λ…Όλ¦¬μ μΌλ΅ λ¶κ°€λ¥ν•μ§€λ§ μ»΄νμΌλ¨)
    SmartPtr&lt;Bottom&gt; p3 = st;
    cout &lt;&lt; "p3μ νƒ€μ…: " &lt;&lt; typeid(p3.get()).name() &lt;&lt; endl;

    cout &lt;&lt; "------" &lt;&lt; endl;

    // β οΈ SmartPtr&lt;double&gt; β†’ SmartPtr&lt;int&gt; (μ΄μƒν•μ§€λ§ μ»΄νμΌλ¨)
    SmartPtr&lt;int&gt; p4 = SmartPtr&lt;double&gt;(new double(3.14));
    cout &lt;&lt; "p4μ νƒ€μ…: " &lt;&lt; typeid(p4.get()).name() &lt;&lt; endl;
    // ν•λ²μ”© μ—λ¬ λ°μƒ
    try {
        cout &lt;&lt; "p4μ ν¬μΈν„° κ°’: " &lt;&lt; *(p4.get()) &lt;&lt; endl;
    } catch(const exception&amp; e) {
        cout &lt;&lt; "μ—λ¬ λ°μƒ: " &lt;&lt; e.what() &lt;&lt; endl;
    }
}

/*
κ²°κ³Ό:
--- μ¬λ°”λ¥Έ λ³€ν™ ---
p1μ νƒ€μ…: P3Top
------
p2μ νƒ€μ…: Pd
p2μ ν¬μΈν„° κ°’: 3.14

--- μλ»λ λ³€ν™ ---
p3μ νƒ€μ…: P6Bottom
------
p4μ νƒ€μ…: Pi
p4μ ν¬μΈν„° κ°’: 6422500
*/
</code></pre>

</details>

---

### β… ν•΄κ²°: κΈ°λ³Έ ν¬μΈν„° μ΄κΈ°ν™”λ¥Ό μ΄μ©ν• μ μ•½

```cpp
template<typename T>
class SmartPtr {
public:
	// otherμ— λ‹΄κΈ΄ ν¬μΈν„°λ¥Ό
	// ν„μ¬ κ°μ²΄μ— λ‹΄κΈ΄ ν¬μΈν„°λ΅ μ΄κΈ°ν™”
	template<typename U>
	SmartPtr(const SmartPtr<U>& other)
	: heldPtr(other.get()) { ... }

	T* get() const { return heldPtr; }

private:
	// κΈ°λ³Έ μ κ³µ ν¬μΈν„°
	T* heldPtr;
};
```

**ν•µμ‹¬:**

- μ΄μ  **νΈν™λλ” νƒ€μ…μ λ§¤κ°λ³€μλ¥Ό λ„κ²¨λ°›μ„ λ•λ§** μ»΄νμΌλλ‹¤
- `heldPtr(other.get())`μ„ ν†µν•΄ κΈ°λ³Έ μ κ³µ ν¬μΈν„°λ¥Ό μ΄κΈ°ν™”ν•  λ•, **μ—λ¬ λ°μƒ μ λ„**
- `U*`κ°€ `T*`λ΅ μ•”μ‹μ  λ³€ν™ κ°€λ¥ν• κ²½μ°μ—λ§ μ»΄νμΌ μ„±κ³µ

---

## π“ μ‹¤μ  shared_ptr κµ¬ν„

```cpp
template<class T>
class shared_ptr {
public:
	// (1) μƒμ„±μ
	template<class Y>
	explicit shared_ptr(Y* p);

	// (2) μΌλ°ν™” λ³µμ‚¬ μƒμ„±μ
	template<class Y>
	shared_ptr(shared_ptr<Y> const& r);

	// (3) μƒμ„±μ
	template<class Y>
	explicit shared_ptr(weak_ptr<Y> const& r);

	// (4) μƒμ„±μ
	template<class Y>
	explicit shared_ptr(auto_ptr<Y>& r);

	// (5) μΌλ°ν™” λ³µμ‚¬ λ€μ… μ—°μ‚°μ
	template<class Y>
	shared_ptr& operator=(shared_ptr<Y> const& r);

	// (6) λ€μ… μ—°μ‚°μ
	template<class Y>
	shared_ptr& operator=(auto_ptr<Y>& r);
	...
};
```

**μ„¤κ³„ λ¶„μ„:**

### **(2) μΌλ°ν™” λ³µμ‚¬ μƒμ„±μκ°€ explicitκ°€ μ•„λ‹ μ΄μ :**

- `shared_ptr<D>` β†’ `shared_ptr<B>`λ΅μ **μ•”μ‹μ  λ³€ν™μ€ ν—μ©**ν•λ‹¤

### **(1)(3)(4)κ°€ explicitμΈ μ΄μ :**

- `κΈ°λ³Έμ κ³µ ν¬μΈν„°`, `weak_ptr`, `auto_ptr`λ΅λ¶€ν„° λ³€ν™μ„ λ§‰κΈ° μ„ν•¨
- λ…μ‹μ  λ³€ν™μ€ κ°€λ¥

### **(4)(6)μ auto_ptrλ§ constκ°€ μ•„λ‹ μ΄μ :**

- `auto_ptr`μ€ λ³µμ‚¬ μ—°μ‚°μΌλ΅ μΈν•΄ κ°μ²΄κ°€ μμ •λ  λ•
- **μ¤μ§ λ³µμ‚¬λ μ½ ν•λ‚λ§ μ ν¨ν•κ² λ‚¨μ•„μ•Ό ν•κΈ° λ•λ¬Έ**

---

## π¨ μ¤‘μ”: μΌλ°ν™” λ³µμ‚¬ ν•¨μ β‰  λ³µμ‚¬ ν•¨μ

λ™μΌν• νƒ€μ…(T==Y)μ shared_ptrμ΄ λ“¤μ–΄μ¤λ©΄?

```cpp
template<class T>
class shared_ptr {
public:
	// (1) λ³µμ‚¬ μƒμ„±μ
	shared_ptr(shared_ptr const& r);

	// (2) μΌλ°ν™” λ³µμ‚¬ μƒμ„±μ
	template<class Y>
	shared_ptr(shared_ptr<Y> const& r);

	// (3) λ³µμ‚¬ λ€μ… μ—°μ‚°μ
	shared_ptr& operator=(shared_ptr const& r);

	// (4) μΌλ°ν™” λ³µμ‚¬ λ€μ… μ—°μ‚°μ
	template<class Y>
	shared_ptr& operator=(shared_ptr<Y> const& r);
	...
};
```

**ν•µμ‹¬ μ›μΉ™:**

- **μΌλ°ν™” λ³µμ‚¬ μƒμ„±μ(2)λ” λ³µμ‚¬ μƒμ„±μ(1)κ°€ μ•„λ‹λ‹¤**
- λ§μ•½, (1)μ„ μ„ μ–Έν•μ§€ μ•μ•λ‹¤λ©΄ μ»΄νμΌλ¬λ” **κΈ°λ³Έ λ³µμ‚¬ μƒμ„±μλ¥Ό μƒμ„±**ν•λ‹¤
- κ·Έλ¬λ―€λ΅, **λ³µμ‚¬ μƒμ„±μμ™€ μΌλ°ν™” λ³µμ‚¬ μƒμ„±μκΉμ§€ μ§μ ‘ μ„ μ–Έν•΄μ•Ό ν•λ‹¤**
- **λ³µμ‚¬ λ€μ… μ—°μ‚°μ(3)μ™€ μΌλ°ν™” λ³µμ‚¬ λ€μ… μ—°μ‚°μ(4)λ„ λ™μΌν•κ² μ μ©**λλ‹¤

---

## π“ λ©¤λ²„ ν•¨μ ν…ν”λ¦Ώ vs μΌλ° λ©¤λ²„ ν•¨μ

| νΉμ„± | μΌλ°ν™” λ³µμ‚¬ μƒμ„±μ | λ³µμ‚¬ μƒμ„±μ |
| --- | --- | --- |
| **μ„ μ–Έ** | `template<class Y> SmartPtr(const SmartPtr<Y>&)` | `SmartPtr(const SmartPtr&)` |
| **μ©λ„** | λ‹¤λ¥Έ νƒ€μ… κ°„ λ³€ν™ | κ°™μ€ νƒ€μ… λ³µμ‚¬ |
| **μ»΄νμΌλ¬ μλ™ μƒμ„±** | β | β… (μ„ μ–Έ μ• ν•λ©΄) |
| **ν•„μ”μ„±** | νƒ€μ… λ³€ν™ μ§€μ› μ‹ | ν•­μƒ ν•„μ” |

---

## π’΅ μ‹¤μ „ ν™μ© ν¨ν„΄

### **μ¬λ°”λ¥Έ μ¤λ§νΈ ν¬μΈν„° μ„¤κ³„:**

```cpp
template<typename T>
class SmartPtr {
public:
	// μΌλ° μƒμ„±μ
	explicit SmartPtr(T* realPtr = 0);

	// λ³µμ‚¬ μƒμ„±μ (λ…μ‹μ )
	SmartPtr(const SmartPtr& other);

	// μΌλ°ν™” λ³µμ‚¬ μƒμ„±μ
	template<typename U>
	SmartPtr(const SmartPtr<U>& other)
	: heldPtr(other.get()) { }

	// λ³µμ‚¬ λ€μ… μ—°μ‚°μ (λ…μ‹μ )
	SmartPtr& operator=(const SmartPtr& other);

	// μΌλ°ν™” λ³µμ‚¬ λ€μ… μ—°μ‚°μ
	template<typename U>
	SmartPtr& operator=(const SmartPtr<U>& other) {
		heldPtr = other.get();
		return *this;
	}

	T* get() const { return heldPtr; }

private:
	T* heldPtr;
};
```

---

# π§ μ •λ¦¬

1. **νΈν™λλ” λ¨λ“  νƒ€μ…μ„ λ°›μ•„λ“¤μ΄λ” λ©¤λ²„ ν•¨μλ¥Ό λ§λ“¤λ ¤λ©΄ λ©¤λ²„ ν•¨μ ν…ν”λ¦Ώμ„ μ‚¬μ©ν•λ‹¤.**  
μ΄λ¥Ό ν†µν•΄ νƒ€μ… κ°„ λ³€ν™μ„ μ μ—°ν•κ² μ§€μ›ν•  μ μλ‹¤.
2. **μΌλ°ν™”λ λ³µμ‚¬ μƒμ„± μ—°μ‚°κ³Ό μΌλ°ν™”λ λ€μ… μ—°μ‚°μ„ μ„ν•΄ λ©¤λ²„ ν…ν”λ¦Ώμ„ μ„ μ–Έν–λ‹¤ ν•λ”λΌλ„,  
λ³΄ν†µμ λ³µμ‚¬ μƒμ„±μμ™€ λ³µμ‚¬ λ€μ… μ—°μ‚°μλ” μ—¬μ „ν μ§μ ‘ μ„ μ–Έν•΄μ•Ό ν•λ‹¤.**  
μ»΄νμΌλ¬λ” μΌλ°ν™” λ²„μ „μ„ λ³µμ‚¬ μƒμ„±μλ΅ μΈμ‹ν•μ§€ μ•λ”λ‹¤.
3. **κΈ°λ³Έ ν¬μΈν„° μ΄κΈ°ν™”λ¥Ό ν™μ©ν•μ—¬ νƒ€μ… λ³€ν™μ μ λ²•μ„±μ„ μ»΄νμΌ νƒ€μ„μ— κ²€μ¦ν•  μ μλ‹¤.**  
`U*`κ°€ `T*`λ΅ λ³€ν™ κ°€λ¥ν• κ²½μ°μ—λ§ μ»΄νμΌμ΄ μ„±κ³µν•λ‹¤.
4. **explicit ν‚¤μ›λ“λ” μ‹ μ¤‘ν•κ² μ‚¬μ©ν•μ.**  
μΌλ°ν™” λ³µμ‚¬ μƒμ„±μλ” κΈ°λ³Έ ν¬μΈν„°μ λ™μ‘μ„ λ¨λ°©ν•κΈ° μ„ν•΄ λ³΄ν†µ explicitλ¥Ό λ¶™μ΄μ§€ μ•λ”λ‹¤.